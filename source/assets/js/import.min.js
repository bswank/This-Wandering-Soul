/* globals Nanobar, Leafpub */
$(function(){"use strict";var e={importer:"",file:"",flush:!1,user:!1,media:"",category:!1},a=new Nanobar;$(".import-form").on("submit",function(t){var i=this;t.preventDefault(),a.go(50),Leafpub.highlightErrors(i),$.ajax({url:Leafpub.url("api/import"),type:"PUT",data:e}).done(function(e){e.success?Leafpub.announce($('meta[name="leafpub:language"]').attr("data-changes-saved"),{style:"success"}):(Leafpub.highlightErrors(i,e.invalid),$.alertable.alert(e.message))}).always(function(){a.go(100)})}),$(".submit").on("click",function(){$(this).addClass("disabled"),$(".import-form").submit()}),$(".dropin").on("change",function(a){e.importer=a.currentTarget.value,$(".upload-xml").removeClass("disabled").addClass("visible")}),$("input[type=checkbox]").on("click",function(a){var t=a.currentTarget.dataset.option;e[t]=a.currentTarget.checked}),$("input[type=radio]").on("click",function(a){var t=a.currentTarget.dataset.option;e[t]=a.currentTarget.dataset.type}),$(".upload-xml").on("change",'input[type="file"]',function(t){$(t.delegateTarget).hasClass("disabled")||t.target.files.length&&Leafpub.upload({accept:"xml",files:t.target.files[0],progress:function(e){a.go(e)},url:"api/import"}).then(function(a){a.uploaded.length&&($(".submit").removeClass("disabled"),$(".upload-xml").addClass("disabled"),e.file=a.uploaded[0]),a.failed.length&&$.alertable.alert(a.failed[0].message)})})});